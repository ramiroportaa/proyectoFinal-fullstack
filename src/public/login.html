<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title>Proyecto Final | BackEnd | CoderHouse 2022</title>
</head>
<body>
    <main>     
      <div id="login" class="d-flex align-items-center justify-content-center text-center vh-100">
        <div class="col-md-4 ps-lg-5">
          <h2 class="mt-3">Login de usuario</h2>
          <div class="d-flex justify-content-around m-auto pt-3" style="width: 200px">
                <form id="loginForm" action="/login" method="post">
                    <div class="form-group">
                        <label for="email">Ingrese su e-mail</label>
                        <input class="form-control" type="email" name="email" required>
                        <label for="password">Ingrese su contrase√±a</label>
                        <input class="form-control" type="password" name="password" required>
                    </div>
                    <button class="btn btn-success mt-3" type="submit">Ingresar</button>
                </form>
          </div>
          <a class="btn btn-primary mt-5" href="/register.html">Registrarse</a>
        </div>
      </div>
    </main>

  <!-- SweetAlert -->
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="js/app.js"></script>
  <script>
    getUserDataFromAPI().then(res =>{
      if (currentUser.email) location.href = "/tienda.html";
    });
    const loginForm = document.getElementById("loginForm");
    loginForm.addEventListener("submit", async (e) =>{
      e.preventDefault();
      let formDataObject = Object.fromEntries(new FormData(loginForm).entries());
      let data = await fetch("/login", {
        method: "POST",
        body: JSON.stringify(formDataObject),
        headers: {"Content-Type": "application/json"}
      })
      if (data.redirected) return location.href = data.url;
      data = await data.json();
      Swal.fire({
            title: `<strong>${data.message}</strong>`,
            icon: 'success',
            html: `BIENVENIDO, ${String(data.data.firstName + " " + data.data.lastName).toUpperCase()}`,
            showCloseButton: true,
            showCancelButton: false,
            showConfirmButton: false,
            focusConfirm: false,
            timer: 2000
          }).then(()=>{
            location.href = "/tienda.html";
          });
    })
  </script>

</body>
</html>